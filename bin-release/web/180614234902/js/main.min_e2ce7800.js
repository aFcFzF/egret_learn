var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,s){function o(t){try{h(i.next(t))}catch(e){s(e)}}function a(t){try{h(i["throw"](t))}catch(e){s(e)}}function h(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(o,a)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,s&&(o=s[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(s,r[1])).done)return o;switch(s=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,s=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){h.label=r[1];break}if(6===r[0]&&h.label<o[1]){h.label=o[1],o=r;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(r);break}o[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],s=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,s,o,a,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.$textPos=0,e.$bg=null,e.$playground=null,e.$pgr=null,e.$vertCount=0,e.$per=0,e.$horzCount=10,e.$baseY=0,e.$tShapes=null,e.$currTshape="z",e.$currTshapeData=[],e.$currTshapeCount=0,e.$currTshapeIdx=0,e.$ctrlSpr=null,e.$ctrlTiles=[],e.$currLorR=null,e.$ctrlBtns={38:{sprName:"rotate",spr:null,bg:"rotate_png",start:!1,proc:null,tap:null},40:{sprName:"down",spr:null,bg:"down_png",start:!1,proc:null,tap:null},37:{sprName:"left",spr:null,bg:"left_png",start:!1,proc:null,tap:null},39:{sprName:"right",spr:null,bg:"right_png",start:!1,proc:null,tap:null}},e.i=0,e.interval=0,e.tms=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){var t=this;this.stage.scaleMode=egret.StageScaleMode.NO_SCALE,this.stage.addEventListener(egret.Event.RESIZE,this.paint,this),window.addEventListener("keydown",function(e){return t.keyDownHandler(e.keyCode)}),window.addEventListener("keyup",function(e){return t.keyUpHandler(e.keyCode)});var e=function(){RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,e,t),console.log("载入ui"),t.initUi()},r=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,r,t),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,e,t),RES.loadGroup("preload")};RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,r,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.paint=function(){var t=this,e=this.$stage.$stageWidth,r=this.$stage.$stageHeight;Object.assign(this.$bg,{width:e,height:r});var i=e-100,n=r-120,s=this.$horzCount,o=this.$per=~~(i/s),a=~~(n/o);i=o*s,n=a*o,console.log("宽和高： ",i,n),Object.assign(this.$playground,{x:10,y:10,width:i,height:n}),this.$pgr.clear(),this.$pgr.beginFill(0,.3),this.$pgr.lineStyle(3,16777215,.8),this.$pgr.drawRoundRect(-2,-2,i+2,n+2,4),this.$pgr.lineStyle(1,16777215,.2);for(var h=1;s>h;h++)this.$pgr.moveTo(o*h-1,0),this.$pgr.lineTo(o*h-1,n);for(var h=1;a>h;h++)this.$pgr.moveTo(0,o*h-1),this.$pgr.lineTo(i,o*h-1);this.$pgr.endFill();var l=this.getChildByName("btnGroup");l.width=e-20;var c=~~((l.width-320)/5);l.height=160+c,l.x=10,l.y=~~(n+10+(r-10-n)/2)-~~(3*(l.height-c)/4)-10;["37","39","40"].forEach(function(e,r){console.log("距离",(c+80)*r),t.$ctrlBtns[e].spr.x=(c+80)*r,t.$ctrlBtns[e].spr.y=c+80}),this.$ctrlBtns[38].spr.x=l.width-80,this.$ctrlBtns[38].spr.y=0;var p=this.$tShapes=RES.getRes("preDefine_json"),u=p[this.$currTshape];this.$currTshapeCount=u.shape.length,this.drawElement(u,0)},e.prototype.drawElement=function(t,e){var r=this,i=this.$per,n=t.color,s=n.bg,o=n.shw,a=n.cre;this.$currTshapeData=t.shape[e],this.autoKick(this.$currTshapeData),this.$currTshapeData.forEach(function(t,e){var n=r.$ctrlTiles[e],h=n.$graphics;r.$baseY;n.x=t[0]*i,n.y=t[1]*i,h.clear(),h.beginFill(s),h.drawRect(0,0,i,i),h.beginFill(o);var l=~~(.5*i);h.drawCircle(l+2,l+2,.3*i),h.beginFill(a),h.drawCircle(l,l,.3*i),h.endFill()})},e.prototype.initUi=function(){var t=this,e=this.$bg=new egret.Bitmap,r=RES.getRes("bg_jpg"),i=this.$stage.$stageWidth,n=this.$stage.$stageHeight;e.width=i,e.height=n,e.texture=r,e.fillMode=egret.BitmapFillMode.CLIP,this.addChild(e);var s=this.$playground=new egret.Sprite;this.$pgr=this.$playground.$graphics;this.addChild(s);var o=this.$ctrlSpr=new egret.Sprite;this.$playground.addChild(o);for(var a=0;4>a;a++){var h=new egret.Shape;this.$ctrlTiles.push(h),this.$ctrlSpr.addChild(h)}var l=new egret.Sprite;l.name="btnGroup",Object.keys(this.$ctrlBtns).forEach(function(e){var r=t.$ctrlBtns[e];r.spr=new egret.Sprite,r.spr.name=r.sprName,r.bg=new egret.Bitmap(RES.getRes(t.$ctrlBtns[e].bg)),r.bg.fillMode=egret.BitmapFillMode.SCALE,r.spr.width=r.bg.width=80,r.spr.height=r.bg.height=80,r.spr.touchEnabled=!0,r.spr.addEventListener(egret.TouchEvent.TOUCH_BEGIN,t.keyDownHandler.bind(t,+e),t),r.spr.addEventListener(egret.TouchEvent.TOUCH_END,t.keyUpHandler.bind(t,+e),t),r.spr.addChild(r.bg),l.addChild(r.spr)}),this.addChild(l),this.paint()},e.prototype.isBorder=function(t){if(void 0===t)throw new Error("必须指定是否检测左边界！");var e=(this.$currTshape,this.$currTshapeIdx,this.$baseY),r=this.$currTshapeData[0][0],i=this.$currTshapeData[1][0],n=[r,i];return this.$currTshapeData.forEach(function(t){var e=t[0];e<n[0]&&(n[0]=e),e>n[1]&&(n[1]=e)}),t&&n[0]+e<=0?!0:!t&&n[1]+e+1>=this.$horzCount?!0:!1},e.prototype.moveLeft=function(){return this.isBorder(!0)?null:(this.$baseY--,this.$ctrlSpr.x-=this.$per,void console.log("向左移动了",this.$baseY))},e.prototype.moveRight=function(){return this.isBorder(!1)?null:(this.$baseY++,this.$ctrlSpr.x+=this.$per,void console.log("向右移动了",this.$baseY))},e.prototype.autoKick=function(t){var e=[t[0][0],t[1][0]];t.forEach(function(t){var r=t[0];r<e[0]&&(e[0]=r),r>e[1]&&(e[1]=r)});var r=e[1]-e[0]+1;this.$ctrlSpr.width=this.$per*r,this.$ctrlSpr.height=this.$per*r,this.$ctrlSpr.x<0&&this.moveRight();var i=this.$per*this.$horzCount;for(console.log("autoKick:",(this.$baseY+r)*this.$per,i);(this.$baseY+r)*this.$per>i;)this.moveLeft()},e.prototype.repeatProc=function(t){return this.interval++%2===0&&t.call(this),this.interval>1e5&&(this.interval=0),!0},e.prototype.hasRepeat=function(t){return!!this.$ctrlBtns[t].start},e.prototype.startRepeatProc=function(t,e){var r=this;return this.$ctrlBtns[t].start?null:((37===t||39===t)&&this.$currLorR!==t&&this.$ctrlBtns[this.$currLorR]&&this.$ctrlBtns[this.$currLorR].start&&this.stopRepeatProc(this.$currLorR),e.call(this),this.tms=Date.now(),void(this.$ctrlBtns[t].tap=egret.setTimeout(function(){r.$ctrlBtns[t].tap&&(r.$ctrlBtns[t].proc=e.bind(r),r.$ctrlBtns[t].start=egret.setInterval(function(){return r.$ctrlBtns[t].start&&e.call(r)},r,20),(37===t||39===t)&&(r.$currLorR=t))},this,80)))},e.prototype.stopRepeatProc=function(t){return this.createText.call(this,Date.now()-this.tms),egret.clearTimeout(this.$ctrlBtns[t].tap),this.$ctrlBtns[t].tap=null,this.hasRepeat(t)?(this.$ctrlBtns[t].start&&egret.clearInterval(this.$ctrlBtns[t].start),void(this.$ctrlBtns[t].start=!1)):null},e.prototype.createText=function(t){var e=new egret.TextField;e.x=0,e.y=this.$textPos,this.$textPos+=20,e.text="按下"+t,e.size=14,this.$playground.addChild(e)},e.prototype.keyDownHandler=function(t){switch(t){case 38:var e=++this.$currTshapeIdx%this.$currTshapeCount;this.drawElement(this.$tShapes[this.$currTshape],e);break;case 32:var r=Object.keys(this.$tShapes)[this.i++];this.$currTshape=r,this.$currTshapeIdx=0,this.$currTshapeCount=this.$tShapes[this.$currTshape].shape.length;break;case 37:this.startRepeatProc(t,this.moveLeft);break;case 39:this.startRepeatProc(t,this.moveRight);break;case 40:this.startRepeatProc(t,this.createText)}},e.prototype.keyUpHandler=function(t){this.stopRepeatProc(t)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);